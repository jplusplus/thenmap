<!DOCTYPE html>
<html lang="sv">
	<head>
		<meta charset=utf-8 />
		<meta name="viewport" content="width=device-width">

		<title>VÃ¤rldskartor: slider</title>

		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script>window.jquery || document.write('<script src="js/jquery.min.js"><\/script>')</script>
		
		<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/i18next/1.6.3/i18next-1.6.3.min.js" />
		<script>window.i18n || document.write('<script src="js/i18next-1.7.1.min.js"><\/script>')</script>

		<script src="js/dragdealer.js" charset="utf-8"></script>

		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/normalize/2.1.3/normalize.min.css">
		<link rel="stylesheet" href="css/dragdealer.css">
		<!--[if lt IE 9]>
			<script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	
		<style>
		body {
			font-family: Arial, "sans-serif";
		}
		#thenmap-play {
			font-size: 16px;
			font-weight: bold;
			cursor: pointer;
			padding: 10px;
			background-color: #C00;
			color: #fff;
			margin: 10px;
			display: inline-block;
			width: 100px;
			text-align: center;
		}
		#thenmap-play:hover {
			background-color: #8A0000;
		}
		</style>
	
	</head>

<body>
	<section id="thenmap">
		<div id="thenmap-timeline">
			<div id="thenmap-slider" class="dragdealer">
				<div class="red-bar handle"></div>
			</div>

		</div> 
		<menu class="controls">
			<div id="thenmap-play" data-i18n="controls.play"></div>
		</menu>
	</section>
		
	<script>

var thenmapCurrentLanguage = 'sv';
var messages = 
{
 "sv": { translation: {
  "name": "ThenMap",
  "controls" : {
   "play": "Spela upp"
  }
 }}
}

/* Init i18n, and translate all messages */
$(document).ready(function(){
	i18n.init({ lng: thenmapCurrentLanguage, 
				debug: true,
				/*useLocalStorage: true, */
				resStore: messages }, function() {
		$(".controls").i18n();
	});
});

/* Init player */
$(document).ready(function(){
	/* Variables */	
	/* cache elements */
	var $thenmap = $("#thenmap");
	var $timelineHandle = $thenmap.find("#thenmap-timeline .handle");
	var $playButton = $thenmap.find("#thenmap-play");
	var $isPlaying = false;
	var timeline;
	var timer;
	
	// Function to draw timeline
	function initTimeline(elementId, year0, year1, yearSelected) {
		var yearSpan = year1 - year0;
		timeline = new Dragdealer('thenmap-slider', {
			step: 1 / (yearSpan + 1), // This option only used to communicate with playTimeline()
			x: 1 - (year1 - yearSelected) / yearSpan, // Set selected year
			snap: true,
			steps: yearSpan+1, // Number of steps
			animationCallback: function(x) {
				// Update handle	
				var year = year0 + x * yearSpan; // Get selecetd year
				$timelineHandle.text(year); // Update handle text
			},
			callback: function(x) {
				// Update map and do other stuff
				var year = year0 + x * yearSpan; // Get selecetd year
				console.log("Redraw map!");
			}
		});
	}
	
	// Function to play
	function playTimeline() {
		timer = setInterval(function() {
			var opt = timeline.options; 
			var newX = opt.x + opt.step; // Set new x value
			timeline.options.x = newX;
			timeline.setValue(newX);
			if (newX >= 1) clearInterval(timer);
		}, 500) // Set animation speed, 2000 = 2 sec
		$isPlaying = true;
	}
	// Function to stop timeline animation
	function stopTimeline() {
		clearInterval(timer);
		$isPlaying = false;
	}
	
	// Click events for play button 
	$playButton.click(function() {
		if ($isPlaying) {
			stopTimeline();
			$playButton.text(i18n.t("play"));
		}
		else {
			playTimeline();
			$playButton.text(i18n.t("pause"));
		}
	})
	
	// Init timeline
	initTimeline('thenmap-slider', 1956, 2013, 1970);
});
		</script>
	</body>
</html>
